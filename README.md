# Readme

## 起動方法

1. git clone
2. npm install
3. sequelize db:migrate
4. npm start
5. localhost:3000にアクセス

****

## 実装したがよく理解していない点

**非同期処理について**

**エラーハンドリング**

**/bin/www内の記述・listenやcreateServerのしていること**

****

以下、実装内容です。

## 実装内容

### 基本課題：「ログイン認証システム」の作成

使用技術：Express4.16.1, express-session, sequelize4.44.3, db:sqlite3

以下のパスからアカウント作成・ログインができます。

*/user/signup*　　*/user/login*　(ロジックは*/routes/users.js*に記述）

簡単ですがバリデーションも実装しました。

### 応用課題1

**1-1 アカウント情報を盗まれた際の被害を軽減**

ライブラリbcryptを使用して、パスワードをハッシュ化して保存するようにしました。bcyptのcompareメソッドで検証しています。

**1-2 悪意のある別サイトからのPOSTを防ぐ**

ライブラリcsurfを使用してCSRF脆弱性の対策をしました。

クッキー(_csrf)とフォームのhidden属性にトークンを入れて検証しています。

**1-3 node.jsアプリケーションを再起動してもログイン状態が持続する**

セッションをサーバーのインメモリではなく、ファイルストアに保存するようにしました。session-file-storeというライブラリを使いました。

/sessionsディレクトリに保存されます。

**1-4 ログイン後の画面のURLを入力した際の挙動**

*ログインしていない時*：リクエストのあったパスをクッキー(ref)に保存してからログイン画面にリダイレクトします。

*ログイン成功後*：クッキー(ref)が存在すれば、そのパスにリダイレクト、なければルートにリダイレクトします。その時、クッキー(ref)を削除します。

この機能は、*/src/require-login.js* 内に書いてあり、ミドルウェアとしてindexルーター内に組み込んであります。

### 応用課題2

**基本機能 ログイン後の画面をログインしたメンバー間でリアルタイムチャットができる画面にする**

socket.ioを使用しました。

クライアント側の処理は*/public/javascripts/io-client.js*

サーバー側の処理は*/src/io-server.js*

に書いてあります。

コードが読みづらくなってしまい、申し訳ございません。

**追加機能2-1 限られたメンバー間でのみチャットができる**

socket.ioのroomを使用して、ルームを作成できるようにしました。

招待機能・ルームメンバー一覧を実装しました。

**追加機能2-2 時間経過でセッションが切れた時に再ログインするまでチャットができないようにする**

一度socket.ioの接続が切れないとセッションを参照できない状態です。

**追加機能2-3 ネットワークに繋がっていない状態でチャット画面にメッセージを入力した時に対応する**

未実装です。